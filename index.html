<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emission Data</title>
    <link rel="stylesheet" href="style.css">
    <!--https://www.w3schools.com/html/html_css.asp-->
</head>

<body>

    <div class="container">

        <div>
            <h1 id="title">Emission Data</h1>
            <p id="subtitle">Use the interactive charts below to explore the dataset</p>
          </div>
        <div id="dropdown">
            <select id="selDataset" onchange="optionChanged(this.value)"></select>
        </div>
        <div id="country"></div>
        <div id="pie"></div>
        <div id="lineplot"></div>



    </div>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        d3.json("data.json").then(function(data) {
            console.log(data)

            let countries = data.countries;
            console.log(countries);

            let emissionData = data.data;
            console.log(emissionData);

            let dropdown = d3.select("#selDataset")

            for (let i=0; i<countries.length; i++) {
                dropdown.append("option").text(countries[i]);
            };


            let selectedCountry = "Albania"
            let selectedYear = 1997

            let title = d3.select("#country");
            title.text(selectedCountry);



            emissions = []
            years =[]

            for (let i=0; i<emissionData.length; i++) {
                if (emissionData[i].Country == selectedCountry) {
                    emissions.push(emissionData[i].Total);
                    years.push(emissionData[i].Year);
                }
            };

            console.log(emissions);
            console.log(years);
            


            let pieLabels = ["Cement", "Coal", "Flaring", "Gas", "Oil", "Other"]
            let pieData = []

            for (let i=0; i<emissionData.length; i++) {
                if (emissionData[i].Country == selectedCountry & emissionData[i].Year == selectedYear) {
                    pieData.push(emissionData[i].Cement);
                    pieData.push(emissionData[i].Coal);
                    pieData.push(emissionData[i].Flaring);
                    pieData.push(emissionData[i].Gas);
                    pieData.push(emissionData[i].Oil);
                    pieData.push(emissionData[i].Other);
                }
            };

            let trace1 = {
                values : pieData,
                labels : pieLabels,
                type : "pie"
            };

            let trace1data = [trace1]

            let layout1 = {
                title : `Emissions in ${selectedYear}`
            };

            <!--https://plotly.com/javascript/pie-charts/-->
            Plotly.newPlot("pie", trace1data, layout1);



            let trace2 = {
                x : years,
                y : emissions,
                type : "scatter",
                mode : "markers"
            };

            let layout2 = {
                title : `Emissions since ${years[0]}`,
                xaxis : {
                    title : "Year"
                },
                yaxis : {
                    title : "MtCO2"
                }
            };

            let traceData2 = [trace2];

            Plotly.newPlot("lineplot", traceData2, layout2);

        });
    </script>

</body>

</html>